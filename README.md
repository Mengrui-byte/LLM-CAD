# AI CAD Architect

> ğŸ¯ è‡ªç„¶è¯­è¨€é©±åŠ¨çš„ 3D CAD å»ºæ¨¡å·¥å…·ï¼Œç±»ä¼¼ Cursor çš„ AI è¾…åŠ©è®¾è®¡ä½“éªŒ

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![build123d](https://img.shields.io/badge/CAD-build123d-green.svg)](https://github.com/gumyr/build123d)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## âœ¨ ç‰¹æ€§

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ¤– **AI ç”Ÿæˆ** | è‡ªç„¶è¯­è¨€ â†’ 3D æ¨¡å‹ï¼ŒCoT è§„åˆ’è‡ªåŠ¨æ‹†è§£éƒ¨ä»¶ |
| âœï¸ **æ‰‹åŠ¨ç¼–è¾‘** | ä»£ç ç¼–è¾‘å™¨ + å‚æ•°è°ƒèŠ‚é¢æ¿ï¼Œå®æ—¶é¢„è§ˆ |
| ğŸ›ï¸ **å¯æ§ç”Ÿæˆ** | éƒ¨ä»¶é”å®šã€é€‰æ‹©æ€§é‡ç”Ÿæˆã€å·®å¼‚ä¿æŠ¤ |
| ğŸ“ **å†å²ç®¡ç†** | è‡ªåŠ¨ä¿å­˜ä¼šè¯ï¼Œæ”¯æŒåŠ è½½/å›æ»š |
| âš¡ **å®æ—¶é¢„è§ˆ** | è§„åˆ’å®Œæˆå³æ˜¾ç¤ºå‚æ•°ï¼Œä»£ç ç”Ÿæˆä¸­å¯è°ƒèŠ‚ |
| ğŸš€ **å¿«é€Ÿæ¸²æŸ“** | å¯è°ƒç²¾åº¦ã€ç¼“å­˜æœºåˆ¶ã€å¯ä¸­æ–­æ¸²æŸ“ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourname/ai-cad-architect.git
cd ai-cad-architect

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é…ç½® LLM

```bash
# OpenAI / å…¼å®¹ API
export LLM_API_KEY="your-api-key"
export LLM_BASE_URL="https://api.openai.com/v1"
export LLM_MODEL="gpt-4"

# æˆ–æœ¬åœ°æ¨¡å‹ (vLLM / Ollama)
export LLM_BASE_URL="http://localhost:8000/v1"
export LLM_MODEL="qwen2.5-coder-32b-instruct"
export LLM_API_KEY="EMPTY"
```

### è¿è¡Œ

```bash
python -m src.app.main
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å»ºæ¨¡

```
è¾“å…¥: åšä¸€ä¸ªåœ†æ¡Œï¼Œæ¡Œé¢ç›´å¾„ 80cmï¼Œé«˜åº¦ 75cmï¼Œå››æ¡è…¿
```

AI è‡ªåŠ¨è§„åˆ’å¹¶ç”Ÿæˆï¼š
- `table_top` - åœ†å½¢æ¡Œé¢
- `leg_1` ~ `leg_4` - å››æ¡æ¡Œè…¿

### è¿­ä»£ä¿®æ”¹

```
æŠŠæ¡Œè…¿å˜ç²—ä¸€ç‚¹
å¢åŠ ä¸€ä¸ªæŠ½å±‰
æ”¹æˆæ­£æ–¹å½¢æ¡Œé¢
```

### å‚æ•°è°ƒèŠ‚

1. åˆ‡æ¢åˆ°ã€Œå‚æ•°è°ƒèŠ‚ã€æ ‡ç­¾
2. ä¿®æ”¹æ•°å€¼ï¼ˆå¦‚ `table_top_radius = 400`ï¼‰
3. ç‚¹å‡»ã€Œæ¸²æŸ“ã€

### æ‰‹åŠ¨ç¼–è¾‘

ç›´æ¥ç¼–è¾‘ build123d ä»£ç ï¼š

```python
with BuildPart() as table_top:
    with BuildSketch(Plane.XY.offset(750)):
        Circle(radius=400)
    extrude(amount=30)
```

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢ (PyQt5)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å¯¹è¯æ¡†  â”‚  â”‚ä»£ç ç¼–è¾‘ â”‚  â”‚å‚æ•°é¢æ¿ â”‚  â”‚3D é¢„è§ˆ  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Controller (MVC)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FullGenerator                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Planner â”‚ â†’ â”‚LoopGen  â”‚ â†’ â”‚ProfileG â”‚ â†’ â”‚ SolidG  â”‚     â”‚
â”‚  â”‚  (CoT)  â”‚   â”‚ (å‚æ•°)  â”‚   â”‚ (è‰å›¾)  â”‚   â”‚ (å®ä½“)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Renderer (multiprocessing) â†’ STL/STEP â†’ PyVista 3D         â”‚
â”‚  â”œâ”€ å¿«é€Ÿé¢„è§ˆæ¨¡å¼ (low-poly)                                  â”‚
â”‚  â”œâ”€ æ¸²æŸ“ç¼“å­˜ (MD5 å“ˆå¸Œ)                                      â”‚
â”‚  â””â”€ å¯ä¸­æ–­ (terminate)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                    # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ main.py            # å…¥å£ (multiprocessing spawn)
â”‚   â”œâ”€â”€ window.py          # PyQt5 ä¸»çª—å£
â”‚   â”œâ”€â”€ controller.py      # MVC æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ llm_client.py      # LLM å®¢æˆ·ç«¯
â”‚   â””â”€â”€ workers.py         # å¼‚æ­¥ Worker
â”‚
â”œâ”€â”€ core/                   # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ part_graph.py      # éƒ¨ä»¶ä¾èµ–å›¾
â”‚   â”œâ”€â”€ plan_validator.py  # è§„åˆ’éªŒè¯
â”‚   â”œâ”€â”€ diff_guard.py      # å·®å¼‚ä¿æŠ¤
â”‚   â””â”€â”€ code_emitter.py    # ä»£ç ç”Ÿæˆ
â”‚
â”œâ”€â”€ generators/             # AI ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ gen_full.py        # å®Œæ•´æµç¨‹ç¼–æ’
â”‚   â”œâ”€â”€ planner.py         # CoT è§„åˆ’å™¨
â”‚   â”œâ”€â”€ gen_loop.py        # å‚æ•°ç”Ÿæˆ
â”‚   â”œâ”€â”€ gen_profile.py     # 2D è‰å›¾ç”Ÿæˆ
â”‚   â”œâ”€â”€ gen_solid.py       # 3D å®ä½“ç”Ÿæˆ
â”‚   â”œâ”€â”€ refiner.py         # ä»£ç ç²¾ç‚¼
â”‚   â””â”€â”€ renderer.py        # æ¸²æŸ“æ‰§è¡Œ (å¯é…ç½®ç²¾åº¦)
â”‚
â”œâ”€â”€ ui/                     # ç•Œé¢èµ„æº
â”‚   â””â”€â”€ Main.qml           # QML ç•Œé¢
â”‚
â””â”€â”€ utils/                  # å·¥å…·
    â”œâ”€â”€ code_utils.py      # ä»£ç å¤„ç†/è‡ªåŠ¨ä¿®å¤
    â””â”€â”€ history_manager.py # å†å²ç®¡ç†
```

## ğŸ”§ æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·è¾“å…¥: "åšä¸€æŠŠæ¤…å­"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Planner (CoT è§„åˆ’)               â”‚
â”‚    â†’ æ‹†è§£ä¸º: seat, backrest, legÃ—4  â”‚
â”‚    â†’ è®¡ç®—ä½ç½®/ä¾èµ–å…³ç³»               â”‚
â”‚    â†’ ğŸ“¢ è§¦å‘ plan_ready å›è°ƒ        â”‚ â† å‚æ•°é¢æ¿ç«‹å³æ˜¾ç¤ºé¢„ä¼°å‚æ•°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¯¹æ¯ä¸ªéƒ¨ä»¶ç”Ÿæˆä»£ç                 â”‚
â”‚    â”œâ”€ LoopGen: å‚æ•°å®šä¹‰             â”‚
â”‚    â”œâ”€ ProfileGen: 2D è‰å›¾           â”‚
â”‚    â””â”€ SolidGen: 3D å®ä½“             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç»„è£… + ä»£ç ä¿®å¤                   â”‚
â”‚    â†’ fix_common_errors()            â”‚
â”‚    â†’ æ³¨å…¥ä¼˜åŒ–å¯¼å‡ºé€»è¾‘                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Renderer æ‰§è¡Œ (ç‹¬ç«‹è¿›ç¨‹)          â”‚
â”‚    â†’ multiprocessing.Process        â”‚
â”‚    â†’ å¯éšæ—¶å–æ¶ˆ (terminate)          â”‚
â”‚    â†’ è¾“å‡º STL/STEP                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ æ¸²æŸ“ä¼˜åŒ–

### å¿«é€Ÿé¢„è§ˆæ¨¡å¼

å‹¾é€‰ã€Œå¿«é€Ÿé¢„è§ˆã€å¯æ˜¾è‘—æå‡æ¸²æŸ“é€Ÿåº¦ï¼š

| æ¨¡å¼ | ç²¾åº¦ | é€Ÿåº¦ |
|------|------|------|
| å¿«é€Ÿé¢„è§ˆ | ä½ | ~3-5x å¿« |
| æ­£å¸¸ | ä¸­ | é»˜è®¤ |
| é«˜ç²¾åº¦ | é«˜ | é€‚åˆå¯¼å‡º |

### æ¸²æŸ“å¯ä¸­æ–­

ç‚¹å‡»ã€Œå–æ¶ˆã€æŒ‰é’®å¯ç«‹å³ç»ˆæ­¢æ¸²æŸ“è¿›ç¨‹ï¼š

```python
# å†…éƒ¨å®ç°
def cancel_render(self):
    self._render_process.terminate()  # ä¼˜é›…ç»ˆæ­¢
    self._render_process.join(timeout=1)
    if self._render_process.is_alive():
        self._render_process.kill()   # å¼ºåˆ¶æ€æ­»
```

### æ¸²æŸ“ç¼“å­˜

ç›¸åŒä»£ç ä¸ä¼šé‡å¤æ¸²æŸ“ï¼ˆé€šè¿‡ MD5 å“ˆå¸Œåˆ¤æ–­ï¼‰ã€‚

### é…ç½®æ¸²æŸ“ç²¾åº¦

```python
from src.generators.renderer import set_render_quality

set_render_quality("preview")  # æœ€å¿«
set_render_quality("normal")   # é»˜è®¤
set_render_quality("high")     # é«˜ç²¾åº¦å¯¼å‡º
```

## ğŸ›ï¸ å¯æ§ç”Ÿæˆ API

### éƒ¨ä»¶é”å®š

```python
# é”å®šéƒ¨ä»¶ï¼ŒAI é‡æ–°ç”Ÿæˆæ—¶ä¸ä¼šä¿®æ”¹
controller.lockPart("table_top")
controller.unlockPart("table_top")
```

### é€‰æ‹©æ€§é‡ç”Ÿæˆ

```python
# åªé‡æ–°ç”ŸæˆæŒ‡å®šéƒ¨ä»¶
controller.regeneratePart("table_leg_1")
```

### çº¦æŸç”Ÿæˆ

```python
# å¸¦çº¦æŸæ¡ä»¶ç”Ÿæˆ
generator.generate_full_code(
    "åšä¸€ä¸ªæ¡Œå­",
    constraints={
        "max_height": 800,
        "material": "wood",
        "style": "modern"
    }
)
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ |
|------|------|
| UI æ¡†æ¶ | PyQt5 / PySide6 |
| 3D å¼•æ“ | build123d (OCC å†…æ ¸) |
| 3D å¯è§†åŒ– | PyVista + VTK |
| LLM | OpenAI å…¼å®¹ API |
| æ¸²æŸ“éš”ç¦» | multiprocessing (spawn) |
| æ¶æ„æ¨¡å¼ | MVC + ä¿¡å·æ§½ + è¿›ç¨‹æ±  |

## ğŸ“ å¼€å‘

### è¿è¡Œæµ‹è¯•

```bash
python -m pytest tests/
```

### ä»£ç é£æ ¼

```bash
# æ ¼å¼åŒ–
black src/
# ç±»å‹æ£€æŸ¥
mypy src/
```

### æ·»åŠ æ–°çš„ç”Ÿæˆå™¨

1. åœ¨ `src/generators/` åˆ›å»º `gen_xxx.py`
2. å®ç° `generate_xxx_code()` æ–¹æ³•
3. åœ¨ `gen_full.py` ä¸­é›†æˆ

## ğŸ› å¸¸è§é—®é¢˜

### build123d æŠ¥é”™ `WorkplaneList does not accept Vector`

**åŸå› **: ä½¿ç”¨äº† `BuildSketch(path @ 0)` è¯­æ³•ï¼Œ`path @ 0` è¿”å› `Vector` è€Œé `Plane`

**è§£å†³**: ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿®å¤ï¼Œæˆ–æ‰‹åŠ¨ä½¿ç”¨ `Plane.XY.offset(z)`

```python
# âŒ é”™è¯¯
with BuildSketch(line @ 0):
    Circle(radius=10)

# âœ… æ­£ç¡®
with BuildSketch(Plane.XY.offset(50)):
    Circle(radius=10)
```

### æ¸²æŸ“å¡æ­»/å¤ªæ…¢

1. å‹¾é€‰ã€Œå¿«é€Ÿé¢„è§ˆã€æ¨¡å¼
2. ç‚¹å‡»ã€Œå–æ¶ˆã€ä¸­æ–­æ¸²æŸ“
3. æ£€æŸ¥æ¨¡å‹å¤æ‚åº¦ï¼Œç®€åŒ–å¸ƒå°”è¿ç®—

### PyVista 3D é¢„è§ˆä¸æ˜¾ç¤º

1. ç¡®è®¤ PyVista å’Œ pyvistaqt å·²å®‰è£…
2. æ£€æŸ¥ç»ˆç«¯æ˜¯å¦æœ‰ `[Warning] PyVista not available` 
3. æ¨¡å‹æ–‡ä»¶ä»ä¼šä¿å­˜åˆ° `output/model.stl`

### LLM ç”Ÿæˆä»£ç è´¨é‡å·®

1. æ£€æŸ¥ prompt æ˜¯å¦æ¸…æ™°
2. å°è¯•æ›´å¼ºçš„æ¨¡å‹ (GPT-4 / Claude-3)
3. åœ¨ `gen_solid.py` ä¸­è°ƒæ•´ç¤ºä¾‹ä»£ç 

## ğŸ“„ License

MIT License - è‡ªç”±ä½¿ç”¨ï¼Œæ¬¢è¿è´¡çŒ®ï¼

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ PR å’Œ Issueï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ†æ”¯ (`git push origin feature/amazing`)
5. åˆ›å»º Pull Request
